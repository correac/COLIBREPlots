To create the APOGEE_data.hdf5 file included in this repository. The following steps were followed:

======

(1) Reading AstroNN data:

input_filename = "apogee_astroNN-DR17.fits"
astroNN = fits.open(input_filename)
astroNN_dataset = astroNN[1].data
astroNN.close()

GalR = astroNN_dataset['galr']
nonan = np.where(np.isnan(GalR) == False)[0]
GalR = GalR[nonan]
Galz = astroNN_dataset['galz'][nonan]
Galphi = astroNN_dataset['galphi'][nonan]
log_g = astroNN_dataset['LOGG'][nonan]
APOGEE_ID_astroNN = astroNN_dataset['APOGEE_ID'][nonan]

=========

(2) Reading APOGEE data:

input_filename = "allStar-l31c.2.fits"
output_directory = "../"

apogee = fits.open(input_filename)
apogee_dataset = apogee[1].data
apogee.close()

sample = (np.bitwise_and(apogee_dataset['aspcapflag'], 2**23) == 0) & (apogee_dataset['extratarg']==0)
selection = np.where(sample)[0]
APOGEE_ID = apogee_dataset['APOGEE_ID'][selection]
FE_H = apogee_dataset['fe_h'][selection]
MG_FE = apogee_dataset['mg_fe'][selection]
N_FE = apogee_dataset['n_fe'][selection]
O_FE = apogee_dataset['o_fe'][selection]
C_FE = apogee_dataset['c_fe'][selection]

sample = (FE_H > -5) & (MG_FE > -5) & (O_FE > -5) & (C_FE > -5) & (N_FE > -5)
selection = np.where(sample)[0]
FE_H = FE_H[selection]
MG_FE = MG_FE[selection]
O_FE = O_FE[selection]
N_FE = N_FE[selection]
C_FE = C_FE[selection]
APOGEE_ID = APOGEE_ID[selection]

======

(3) Cross-match of catalogs using the stars IDs!

_, indx_APOGEE_in_astroNN, indx_astroNN_in_APOGEE = np.intersect1d(APOGEE_ID, APOGEE_ID_astroNN, assume_unique=False, return_indices=True,)

GalR = GalR[indx_astroNN_in_APOGEE]
Galz = Galz[indx_astroNN_in_APOGEE]
Galphi = Galphi[indx_astroNN_in_APOGEE]

FE_H = FE_H[indx_APOGEE_in_astroNN]
MG_FE = MG_FE[indx_APOGEE_in_astroNN]
O_FE = O_FE[indx_APOGEE_in_astroNN]
N_FE = N_FE[indx_APOGEE_in_astroNN]
C_FE = C_FE[indx_APOGEE_in_astroNN]

======

(4) Outputting..

# Meta-data
description = "The APOGEE chemical abundances taken from APOGEE data access (https://www.sdss.org/dr14/irspec/spectro_data/#catalogs) "
description += "cross-matched with AstroNN galactocentric distances (https://data.sdss.org/datamodel/files/APOGEE_ASTRONN/apogee_astronn.html). "
description += "For more information visit ASPCAP documentation (https://www.sdss.org/dr14/irspec/aspcap/)"

comment = "Solar abundances converted to Asplund et al. (2009)"
citation = "Holtzman, J. A. et al. (2018); Leung, H.W. & Bovy, Jo (2019b)"
bibcode = "2018AJ....156..125H; 2019MNRAS.483.3255L"

contact = "Data file generated by Camila Correa (University of Amsterdam). Email: camila.correa@uva.nl,"
contact += " website: camilacorrea.com"

details = "Details regarding the generation of this table. From APOGEE the allStar-l31c.2.fits is read, the aspcapflag == 2**23 and "
details += "extratarg == 0 flags are applied for selection cuts. Additionally, FE_H > -5 (and elem_FE > -5) abundance cuts are also applied. For the "
details += "AstroNN added-value catalogs, the apogee_astroNN-DR17.fits file is read and nonan data is selected. "
details += "The Galactocentric positions (R [kpc], z [kpc], phi [rad]) were calculated assuming that "
details += "the distance R0 to the Galactic center is 8.125 kpc (Gravity collaboration et al. 2018), the Sun is located 20.8 pc above "
details += "the Galactic midplane (Bennett & Bovy 2019)."

output_file = "APOGEE_data.hdf5"

## Output in file
with h5py.File(output_file, 'w') as data_file:

    Header = data_file.create_group('Header')
    Header.attrs["Description"] = np.string_(description)
    Header.attrs["Further Details"] = np.string_(details)
    Header.attrs["Citation"] = np.string_(citation)
    Header.attrs["Comment"] = np.string_(comment)
    Header.attrs["Bibcode"] = np.string_(bibcode)
    Header.attrs["Contact"] = np.string_(contact)

    data_file.create_dataset('MG_FE', data=MG_FE)
    data_file.create_dataset('O_FE', data=O_FE)
    data_file.create_dataset('N_FE', data=N_FE)
    data_file.create_dataset('C_FE', data=C_FE)
    dataset = data_file.create_dataset('FE_H', data=FE_H)
    dataset.attrs["Description"] = np.string_("Note APOGEE's solar scale should be close to the Grevasse et al. (2007) solar values.")

    dataset = data_file.create_dataset('GalR', data=GalR)
    dataset.attrs["Description"] = np.string_("Units kpc.")

    data_file.create_dataset('Galz', data=Galz)
    dataset.attrs["Description"] = np.string_("Units kpc.")

    data_file.create_dataset('Galphi', data=Galphi)


